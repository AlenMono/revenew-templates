<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=1080, initial-scale=1.0">
    <title>Filter UI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            width: 1080px;
            margin: 0 auto;
        }

        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }

        .loader__wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;

            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #c1c1c1d5;
            z-index: 9999
        }

        .card--success {
            display: flex;
            align-items: center;
            justify-content: center;

            padding: 12px 24px;

            background-color: #e74c3c;
            color: #fff;
            border-radius: 4px;
        }

        /* Chrome, Safari, Edge, Opera */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Firefox */
        input[type=number] {
            -moz-appearance: textfield;
        }

        .loader {
            width: 50px;
            aspect-ratio: 1;
            border-radius: 50%;
            border: 8px solid;
            border-color: #e74c3c #0000;
            animation: l1 1s infinite;
        }

        @keyframes l1 {
            to {
                transform: rotate(.5turn)
            }
        }

        .card--primary {
            position: relative;

            display: flex;
            flex-direction: column;

            max-width: 1080px;
            margin: 0 auto;

            padding: 16px;

            background-color: #eee;
        }

        .btn--apply {
            padding: 10px 20px;
            display: flex;
            gap: 8px;
            align-items: center;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #000
        }

        .btn--apply svg {
            transition: all 0.3s ease;
            fill: #000;
        }

        .btn--apply:hover {
            background-color: #000000;
            color: white;
        }

        .btn--apply:hover svg {
            fill: white;
        }

        .btn--clear {
            border: none;
            cursor: pointer;

            color: #555;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .btn--clear:hover {
            color: #000;
        }

        .filter__footer {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            margin-top: 12px;
        }

        .selected {
            border-color: red !important;
            background-color: #ffe;
        }

        .input--text {
            min-width: 200px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .filter-section {
            max-width: 1080px;
            margin: 12px auto;
            background: #eee;
            padding: 20px;
        }

        .filter-group {
            margin-bottom: 15px;
        }

        .filter-group label {
            font-weight: bold;
            margin-right: 10px;
        }

        .button-group button,
        .price-group button,
        .cuisine-group button {
            padding: 8px 12px;
            margin: 4px;
            border: 2px solid #000;
            background: #fff;
            cursor: pointer;
            border-radius: 10px;
        }

        .selected {
            border-color: orange;
            background-color: #ffe;
        }

        .stars {
            display: flex;
            gap: 12px;

            font-size: 24px;
            cursor: pointer;
        }

        .star-icon {
            cursor: pointer;
            transition: fill 0.2s;
        }

        .star-icon.selected {
            fill: gold;
            stroke: #000
        }

        .card-opened {
            position: relative;
            border: 2px solid #e74c3c !important;
            z-index: 1;
        }

        .arrow-bottom {
            display: none;
        }

        .card-opened .arrow-bottom {
            display: block;
        }

        .input--search {
            position: relative;
        }

        .input--search .input--text {
            padding-left: 28px;
        }

        .input--search svg {
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
        }

        #suggestions {
            display: none;
            list-style: none;
            padding-left: 0;
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 4px;
            z-index: 10;
        }

        #suggestions li:hover {
            background-color: #f0f0f0;
        }

        .results__list {
            display: grid;
            /* SET AS VARIABLE */
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .results__list__item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;

            padding: 16px 12px;

            text-align: center;

            border: 1px solid #1f1f1f;
            background-color: #fff;

            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        .results__list__item:hover {
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }

        .results__list__item__header {
            width: 100%;

            display: flex;
            align-items: center;
            justify-content: space-between;

            gap: 8px;

            margin-bottom: 6px;
        }

        .results__rating {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .btn--primary {
            padding: 12px 24px;

            color: #fff;
            font-weight: bold;
            background-color: #e74c3c;
            border: 1px solid #e74c3c;

            text-decoration: none;
            cursor: pointer;

            transition: all 0.2s ease-in-out;
        }

        .btn--primary:hover {
            background-color: #c0392b;
            border: 1px solid #c0392b;
        }

        .detail-row {
            display: none;
            grid-column: 1 / -1;
        }

        .detail-row.is-open {
            display: block;
        }

        .detail-card {
            display: grid;
            /* SET AS VARIABLE */
            grid-template-columns: 1fr 2fr;
            gap: 20px;

            width: 100%;
            padding: 20px;

            background: #fff;
        }

        .detail-card__media,
        .detail-card__info {
            display: flex;
            flex-direction: column;
            align-items: center;

            gap: 8px;
        }

        .detail-card__info {
            justify-content: space-between;
            align-items: flex-start;
        }

        .hidden {
            display: none;
        }

        .slider-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            width: 316px;
            height: 200px;
            overflow: hidden;
        }

        .slider {
            display: flex;
            width: 100%;
            height: 100%;
            position: relative;
        }

        .slide {
            min-width: 100%;
            height: 100%;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            display: none;
            transition: opacity 0.5s ease-in-out;
        }

        .slide.active {
            display: block;
        }

        .arrow {
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            color: black;
            background: white;
            border-radius: 50%;
            padding: 5px 10px;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 2;
            user-select: none;
        }

        .arrow.left {
            left: 5px;
        }

        .arrow.right {
            right: 5px;
        }

        .arrow.disabled {
            opacity: 0.3;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div class="filter-section">
        <div
            style="display: flex; gap: 12px; align-items: center; justify-content: space-between; flex-wrap: wrap; margin-bottom: 16px;">
            <div style="position: relative;">
                <div style="display: flex; gap: 8px; align-items: center;">
                    <div style="display: flex; align-items: center;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="#000000"
                            id="Location--Streamline-Tabler-Filled" height="20" width="20">
                            <desc>
                                Location Streamline Icon: https://streamlinehq.com
                            </desc>
                            <path
                                d="M17.409166666666668 1.6716666666666666 17.497500000000002 1.6666666666666667l0.10833333333333334 0.006666666666666667 0.075 0.013333333333333334 0.10250000000000001 0.02916666666666667 0.08916666666666667 0.03833333333333334 0.08333333333333334 0.0475 0.075 0.05583333333333334 0.06833333333333334 0.0625 0.043333333333333335 0.049166666666666664 0.06833333333333334 0.09666666666666668 0.043333333333333335 0.08c0.03916666666666667 0.08333333333333334 0.06416666666666666 0.17166666666666666 0.075 0.26333333333333336l0.004166666666666667 0.08833333333333333c0 0.0625 -0.006666666666666667 0.12416666666666666 -0.02 0.18333333333333335l-0.02916666666666667 0.10250000000000001 -5.443333333333333 15.064166666666669A1.2916666666666667 1.2916666666666667 0 0 1 11.666666666666668 18.6a1.2891666666666666 1.2891666666666666 0 0 1 -1.1075 -0.6225l-0.05416666666666667 -0.10583333333333333 -2.7933333333333334 -5.585 -5.558333333333334 -2.78a1.2916666666666667 1.2916666666666667 0 0 1 -0.7483333333333334 -1.0491666666666666L1.4 8.333333333333334c0 -0.46666666666666673 0.25083333333333335 -0.8933333333333334 0.7008333333333333 -1.1416666666666668l0.11666666666666668 -0.05833333333333334 15.014166666666666 -5.421666666666667 0.08833333333333333 -0.025 0.09 -0.015z"
                                stroke-width="0.8333"></path>
                        </svg>
                    </div>
                    <input type="text" id="cityInput" class="input--text" placeholder="Enter City or Zip Code"
                        autocomplete="off" />

                </div>
                <ul id="suggestions"></ul>
            </div>

            <div>
                <label for="radius">Radius</label>
                <input type="number" id="radius" value="15"
                    style="width: 44px; padding: 6px 8px; border-radius: 6px;" /> miles
            </div>

            <div class="input--search">
                <input id="restaurantName" type="text" class="input--text" placeholder="Enter Restaurant Name" />
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16">
                    <path
                        d="m14.5 13.793-3.776-3.776a5.509 5.509 0 1 0-.707.707l3.776 3.776ZM2 6.5A4.5 4.5 0 1 1 6.5 11 4.505 4.505 0 0 1 2 6.5Z" />
                    <path fill="none" d="M0 0h16v16H0Z" />
                </svg>
            </div>

            <div>
                <label for="sort">Sort by:</label>
                <select id="sort" style="padding: 6px 8px; border-radius: 6px;">
                    <option value="distance">Closest Distance</option>
                    <option value="priceHighLow">Price High/Low</option>
                    <option value="priceLowHigh">Price Low/High</option>
                    <option value="ratingHighLow">Rating High/Low</option>
                </select>
            </div>

            <div style="display: flex; align-items: center; gap: 8px;">
                <label>
                    <input type="checkbox" id="openNow" />
                </label>
                <p style="font-size: 14x; font-weight: bold;">
                    Open Now
                </p>
            </div>
        </div>

        <div class="filter-group cuisine-group" style="display: flex; align-items: flex-start; gap: 30px">
            <div style="display: flex; align-items: center; gap: 8px;">
                <label>Cuisine</label>
                <button onclick="selectCuisine(this)"
                    style="padding-left: 30px; padding-right: 30px; white-space: nowrap;">Select All</button>
            </div>

            <div id="cuisineList"></div>
        </div>

        <div style="display: flex; align-items: center; gap: 12px;">
            <div class="price-group">
                <label style="font-weight: bold;">Price</label>
                <button onclick="selectPrice(this)">$</button>
                <button onclick="selectPrice(this)">$$</button>
                <button onclick="selectPrice(this)">$$$</button>
                <button onclick="selectPrice(this)">$$$$</button>
            </div>

            <div class="" style="display: flex; align-items: center; gap: 8px">
                <label style="font-weight: bold;">Minimum Rating</label>
                <div class="stars" id="starRating"></div>
            </div>

            <div style="display: flex; align-items: center; justify-content: flex-end; flex: 1; gap: 12px;">
                <div style="display: flex; justify-content: center;">
                    <button onclick="applyFilter()" class="btn--apply">
                        Apply Filter
                    </button>
                </div>
                <div style="display: flex; justify-content: flex-end;">
                    <button onclick="clearFilter()" class="btn--clear">
                        Clear Filter
                    </button>
                </div>
            </div>
        </div>
    </div>


    <div class="loader__wrapper">
        <div class="loader"></div>
    </div>

    <div class="card--success" id="successCard" style="display: none;">
        <p>Congratulations! You can now access over 20,000+ restaurant offers.</p>
    </div>

    <div id="toast-container"></div>
    <div class="card--primary" id="restaurantsResult" style="display: none;">
        <!-- Cards will be inserted here by JS -->
        <div class="results__list" id="cardsContainer"></div>

        <div style="display: flex; flex-direction: column; align-items: center; margin-top: 20px;" id="loadMore">
            <button class="btn--primary" onclick="loadMore()">Show More</button>
        </div>
    </div>

    <script>
        const input = document.getElementById("cityInput");
        const suggestions = document.getElementById("suggestions");
        const container = document.getElementById("cardsContainer");
        const starContainer = document.getElementById('starRating');
        const successCard = document.getElementById('successCard');
        const restaurantsResult = document.getElementById('restaurantsResult');

        const selectedCuisines = new Set();
        const selectedPrices = new Set();
        let restaurants = [];

        let selectedRating = 0;
        let selectedPage = 1;
        let openIndex = null;
        let lat, lon, hasNextPage, debounceTimeout;

        const filledStarSml = `
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none"><path fill="#ffd709" d="M7.709 12.885a.662.662 0 0 1 .582 0l3.542 1.872a.616.616 0 0 0 .897-.65l-.684-4.002a.595.595 0 0 1 .18-.538l2.87-2.769a.605.605 0 0 0-.37-1.042l-3.935-.583a.572.572 0 0 1-.46-.336L8.55 1.239a.605.605 0 0 0-1.098 0L5.669 4.837a.572.572 0 0 1-.46.336l-3.934.583a.605.605 0 0 0-.37 1.042l2.87 2.769a.594.594 0 0 1 .179.538l-.684 4.002a.617.617 0 0 0 .897.65l3.542-1.872Z"/><path fill="#000" fill-rule="evenodd" d="M6.806.93A1.33 1.33 0 0 1 8 .175c.506 0 .978.299 1.193.756l1.756 3.544 3.86.572c.503.05.944.394 1.113.872a1.33 1.33 0 0 1-.33 1.394l-2.831 2.732.673 3.94a1.34 1.34 0 0 1-.53 1.306 1.341 1.341 0 0 1-1.391.105l-.013-.007-3.5-1.85-3.5 1.85a1.342 1.342 0 0 1-1.404-.099 1.341 1.341 0 0 1-.53-1.305l.673-3.94L.41 7.312a1.33 1.33 0 0 1-.33-1.394 1.33 1.33 0 0 1 1.113-.872l3.859-.572L6.806.931Zm2.88 4.214c.185.4.57.681 1.007.737l3.75.555-2.705 2.609c-.32.3-.47.748-.396 1.18l.651 3.808-3.368-1.78a1.383 1.383 0 0 0-1.231-.01.673.673 0 0 0-.02.01l-3.367 1.78.65-3.808.001-.004a1.317 1.317 0 0 0-.395-1.175l-2.705-2.61 3.75-.555c.436-.056.82-.337 1.005-.736L8 1.739l1.687 3.405Z" clip-rule="evenodd"/></svg>
        `

        const filledStar = `
            <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="none"><path fill="#ffd709" d="M12.526 20.938a1.076 1.076 0 0 1 .948 0l5.755 3.041a1.001 1.001 0 0 0 1.458-1.056l-1.112-6.502a.967.967 0 0 1 .292-.875l4.663-4.499a.984.984 0 0 0-.601-1.694l-6.394-.947a.929.929 0 0 1-.746-.546l-2.896-5.847a.984.984 0 0 0-1.786 0L9.211 7.86a.929.929 0 0 1-.746.546l-6.394.947a.983.983 0 0 0-.6 1.694l4.662 4.5a.965.965 0 0 1 .292.874l-1.112 6.502a1.002 1.002 0 0 0 1.458 1.056l5.755-3.041Z"/><path fill="#000" fill-rule="evenodd" d="M11.06 1.513A2.162 2.162 0 0 1 13 .282c.822 0 1.589.486 1.94 1.23l2.852 5.759 6.272.93c.817.08 1.534.64 1.81 1.416a2.162 2.162 0 0 1-.538 2.266l-4.6 4.438 1.094 6.403a2.179 2.179 0 0 1-.861 2.122 2.18 2.18 0 0 1-2.26.171l-.022-.011L13 22l-5.687 3.006a2.18 2.18 0 0 1-2.282-.16 2.18 2.18 0 0 1-.861-2.122l1.094-6.403-4.6-4.438a2.162 2.162 0 0 1-.538-2.266A2.163 2.163 0 0 1 1.937 8.2l6.272-.929 2.852-5.758Zm4.68 6.847c.301.648.926 1.106 1.635 1.196l6.093.903-4.393 4.24h-.002a2.14 2.14 0 0 0-.642 1.916v.001l1.058 6.188-5.473-2.892a2.248 2.248 0 0 0-2.001-.016l-.03.016-5.473 2.892 1.057-6.188.001-.007a2.14 2.14 0 0 0-.642-1.909L2.532 10.46l6.093-.903a2.105 2.105 0 0 0 1.634-1.196L13 2.826l2.74 5.534Z" clip-rule="evenodd"/></svg>
        `;

        const halfStar = `
            <svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M11.0592 1.28164C11.2343 0.899776 11.5092 0.576992 11.8525 0.350306C12.1957 0.12362 12.5935 0.00220969 13 0C13.8223 0 14.5897 0.505992 14.9408 1.2806L17.794 7.2765L24.0685 8.24476C24.8859 8.32805 25.6032 8.91109 25.8793 9.71901C26.0153 10.1247 26.0369 10.5624 25.9415 10.9805C25.8461 11.3985 25.6378 11.7795 25.3411 12.0782L20.7392 16.6988L21.8336 23.3652C21.9012 23.7804 21.8564 24.2069 21.7043 24.5971C21.5522 24.9873 21.2987 25.3257 20.9723 25.5745C20.6473 25.817 20.2645 25.9619 19.8658 25.9933C19.467 26.0247 19.0677 25.9414 18.7113 25.7525L18.6893 25.7411L13 22.6114L7.31067 25.7411C6.95267 25.9361 6.54963 26.0239 6.14652 25.9944C5.74341 25.965 5.35608 25.8196 5.02774 25.5745C4.70138 25.3256 4.44798 24.9872 4.29586 24.597C4.14375 24.2069 4.09892 23.7803 4.16638 23.3652L5.26083 16.6988L0.658947 12.0782C0.362226 11.7795 0.153872 11.3985 0.0584989 10.9805C-0.0368742 10.5624 -0.0152814 10.1247 0.120726 9.71901C0.258885 9.3207 0.502155 8.97101 0.822617 8.71006C1.14308 8.4491 1.52775 8.28747 1.93247 8.24372L8.20704 7.2765L11.0592 1.28164ZM15.7411 8.4103C16.0422 9.08496 16.6675 9.5618 17.3768 9.6555L23.4723 10.5956L19.0775 15.0101H19.0755C18.8188 15.2618 18.6259 15.5756 18.5139 15.9236C18.4018 16.2716 18.3741 16.643 18.4332 17.0049L19.4917 23.4485L14.0164 20.4375C13.7066 20.274 13.3647 20.1875 13.0174 20.1846C12.6701 20.1817 12.3268 20.2626 12.0146 20.4209L11.9846 20.4375L6.50934 23.4485L7.56678 17.0059L7.56778 16.9986C7.62568 16.6379 7.59737 16.2679 7.48536 15.9213C7.37335 15.5747 7.18108 15.2621 6.92551 15.0111L2.52771 10.5967L8.62321 9.65654C8.9743 9.60875 9.30814 9.46959 9.59386 9.25194C9.87959 9.0343 10.108 8.74518 10.2579 8.41134L13 2.64865L13.0174 2.68519L15.7411 8.4103Z" fill="black"/>
                <path d="M12.916 2.14844C13.0865 2.14851 13.2538 2.19937 13.3975 2.29492C13.5409 2.39046 13.655 2.52667 13.7266 2.6875L16.3584 8.21582C16.4182 8.35595 16.512 8.47779 16.6309 8.56836C16.7497 8.65885 16.8898 8.71544 17.0361 8.73242L22.8447 9.62793C23.0168 9.64201 23.1814 9.70721 23.3184 9.81641C23.4554 9.9258 23.5594 10.0747 23.6172 10.2441C23.6749 10.4135 23.6847 10.5967 23.6445 10.7715C23.6043 10.9463 23.5158 11.1056 23.3906 11.2295L19.1543 15.4834C19.0476 15.5873 18.9672 15.7171 18.9209 15.8613C18.8746 16.0058 18.8632 16.1606 18.8887 16.3105L19.8994 22.458C19.9289 22.6328 19.9107 22.813 19.8467 22.9775C19.7826 23.142 19.6752 23.2846 19.5371 23.3887C19.399 23.4927 19.2355 23.5544 19.0654 23.5664C18.8953 23.5784 18.7256 23.5397 18.5752 23.4561L13.3467 20.5811C13.2128 20.5127 13.0652 20.4776 12.916 20.4775H12.9141V2.14941L12.916 2.14844Z" fill="white"/>
                <path d="M12.9121 2.14844C12.7415 2.14844 12.5744 2.19931 12.4307 2.29492C12.287 2.39052 12.1722 2.52647 12.1006 2.6875L9.46973 8.21582C9.4099 8.35592 9.31613 8.4778 9.19727 8.56836C9.07836 8.65893 8.93843 8.71543 8.79199 8.73242L2.9834 9.62793C2.8112 9.64202 2.64586 9.70704 2.50879 9.81641C2.37172 9.92579 2.2687 10.0747 2.21094 10.2441C2.15319 10.4136 2.14343 10.5967 2.18359 10.7715C2.22377 10.9463 2.31141 11.1056 2.43652 11.2295L6.67285 15.4834C6.77972 15.5873 6.86089 15.7169 6.90723 15.8613C6.95356 16.0058 6.96397 16.1606 6.93848 16.3105L5.92871 22.458C5.89918 22.6328 5.91739 22.813 5.98145 22.9775C6.04551 23.1419 6.15295 23.2846 6.29102 23.3887C6.42907 23.4926 6.59268 23.5544 6.7627 23.5664C6.93276 23.5784 7.10262 23.5397 7.25293 23.4561L12.4814 20.5811C12.6155 20.5126 12.7628 20.4775 12.9121 20.4775H12.9141V2.14941L12.9121 2.14844Z" fill="#FFD709"/>
            </svg>
        `

        const outlineStar = `
            <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="none"><path fill="" d="M12.526 20.938a1.076 1.076 0 0 1 .948 0l5.755 3.041a1.001 1.001 0 0 0 1.458-1.056l-1.112-6.502a.967.967 0 0 1 .292-.875l4.663-4.499a.984.984 0 0 0-.601-1.694l-6.394-.947a.929.929 0 0 1-.746-.546l-2.896-5.847a.984.984 0 0 0-1.786 0L9.211 7.86a.929.929 0 0 1-.746.546l-6.394.947a.983.983 0 0 0-.6 1.694l4.662 4.5a.965.965 0 0 1 .292.874l-1.112 6.502a1.002 1.002 0 0 0 1.458 1.056l5.755-3.041Z"/><path fill="#000" fill-rule="evenodd" d="M11.06 1.513A2.162 2.162 0 0 1 13 .282c.822 0 1.589.486 1.94 1.23l2.852 5.759 6.272.93c.817.08 1.534.64 1.81 1.416a2.162 2.162 0 0 1-.538 2.266l-4.6 4.438 1.094 6.403a2.179 2.179 0 0 1-.861 2.122 2.18 2.18 0 0 1-2.26.171l-.022-.011L13 22l-5.687 3.006a2.18 2.18 0 0 1-2.282-.16 2.18 2.18 0 0 1-.861-2.122l1.094-6.403-4.6-4.438a2.162 2.162 0 0 1-.538-2.266A2.163 2.163 0 0 1 1.937 8.2l6.272-.929 2.852-5.758Zm4.68 6.847c.301.648.926 1.106 1.635 1.196l6.093.903-4.393 4.24h-.002a2.14 2.14 0 0 0-.642 1.916v.001l1.058 6.188-5.473-2.892a2.248 2.248 0 0 0-2.001-.016l-.03.016-5.473 2.892 1.057-6.188.001-.007a2.14 2.14 0 0 0-.642-1.909L2.532 10.46l6.093-.903a2.105 2.105 0 0 0 1.634-1.196L13 2.826l2.74 5.534Z" clip-rule="evenodd"/></svg>
        `;

        const debounce = (func, delay) => {
            return function (...args) {
                clearTimeout(debounceTimeout);
                debounceTimeout = setTimeout(() => func.apply(this, args), delay);
            };
        }

        const showLoading = (isLoading) => {
            const loaderWrapper = document.querySelector(".loader__wrapper");

            if (isLoading) {
                loaderWrapper.style.display = "flex";
            } else {
                loaderWrapper.style.display = "none";
            }
        }

        const fetchCities = async (query) => {
            if (!query) {
                suggestions.innerHTML = "";
                input.cityId = null
                return;
            }

            try {
                // const res = await fetch(`{api}OfferCommunication/City?Name=${encodeURIComponent(query)}`, {
                const res = await fetch(`https://api-staging.revenewllc.com/api/OfferCommunication/City?Name=${encodeURIComponent(query)}`, {
                    method: "GET",
                    credentials: 'include',
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Basic ZTUzNGUwM2UtYWQ2NS00MjRhLWI5ZmYtMzc0NmM0NWMxODhhLTM1MDE2OTQ4LTlmZTctNDUzYy05OWQxLTk4NjZmZmIzNDEyYy00MDQ2ODhmNC03NGI2LTRlOTAtYTFhYS1hYmM1NTBjZTRhYTE="
                        // "Authorization": "Basic {apiKey}"
                    }
                });

                const data = await res.json();
                displaySuggestions(data || []);
            } catch (err) {
                console.error("City lookup failed:", err);
            }
        }

        const displaySuggestions = (cities) => {
            suggestions.innerHTML = "";
            suggestions.style.display = cities.length ? "block" : "none";

            cities.forEach((city) => {
                const li = document.createElement("li");
                li.textContent = city.name;

                li.style.cursor = "pointer";
                li.style.padding = "8px 10px";
                li.style.fontSize = "14px";

                li.addEventListener("click", () => {
                    input.cityId = city.id;
                    input.value = city.name;

                    suggestions.innerHTML = "";
                    suggestions.style.display = "none";
                });

                suggestions.appendChild(li);
            });
        }

        input.addEventListener(
            "input",
            debounce((e) => {
                const query = e.target.value.trim();
                fetchCities(query);
            }, 400)
        );

        const selectCuisine = (button) => {
            const allButtons = Array.from(document.querySelectorAll('.cuisine-group button'));
            const cuisineButtons = allButtons.filter(b => b.innerText !== "Select All");

            if (button.innerText === "Select All") {
                const allSelected = cuisineButtons.every(btn => btn.classList.contains('selected'));

                cuisineButtons.forEach(btn => {
                    btn.classList.toggle('selected', !allSelected);
                    if (!allSelected) {
                        selectedCuisines.add(btn.innerText);
                    } else {
                        selectedCuisines.delete(btn.innerText);
                    }
                });

                button.classList.toggle('selected', !allSelected);
                if (!allSelected) {
                    selectedCuisines.add("Select All");
                } else {
                    selectedCuisines.delete("Select All");
                }
            } else {
                button.classList.toggle("selected");

                if (button.classList.contains("selected")) {
                    selectedCuisines.add(button.innerText);
                } else {
                    selectedCuisines.delete(button.innerText);
                }

                const allSelected = cuisineButtons.every(btn => btn.classList.contains('selected'));
                const selectAllBtn = allButtons.find(b => b.innerText === "Select All");

                selectAllBtn.classList.toggle("selected", allSelected);
                if (allSelected) {
                    selectedCuisines.add("Select All");
                } else {
                    selectedCuisines.delete("Select All");
                }
            }
        };

        const selectPrice = (button) => {
            button.classList.toggle("selected");
            const priceLevel = button.innerText.trim().lastIndexOf('$') + 1;

            if (button.classList.contains("selected")) {
                selectedPrices.add(priceLevel);
            } else {
                selectedPrices.delete(priceLevel);
            }
        };

        const renderStars = (rating) => {
            let fullStars = Math.floor(rating);
            const decimal = rating - fullStars;

            let hasHalf = false;

            if (decimal >= 0.3 && decimal <= 0.7) {
                hasHalf = true;
            } else if (decimal > 0.7) {
                fullStars += 1;
            }

            return Array.from({ length: 5 }, (_, i) => {
                const index = i + 1;
                let star = outlineStar;
                if (index <= fullStars) {
                    star = filledStar;
                } else if (index === fullStars + 1 && hasHalf) {
                    star = halfStar;
                }

                return `<span class="star-wrapper" data-index="${index}" style="cursor: pointer; display: inline-block;">${star}</span>`;
            }).join('');
        };

        const updateStars = (rating) => {
            starContainer.innerHTML = renderStars(rating);

            starContainer.querySelectorAll('.star-wrapper').forEach((el) => {
                el.addEventListener('click', () => {
                    const index = parseInt(el.dataset.index);
                    selectedRating = (selectedRating === index) ? 0 : index;
                    updateStars(selectedRating);
                });
            });
        };

        function setRating(rating) {
            selectedRating = selectedRating === rating ? 0 : rating;
            renderStars();
        }

        function applyFilter(isShowMore) {
            showLoading(true);
            const locationId = document.getElementById("cityInput").cityId;
            const radius = document.getElementById("radius").value;
            const sort = document.getElementById("sort").value;
            const openNow = document.getElementById("openNow").checked;
            const restaurantName = document.querySelector("#restaurantName")?.value?.trim();

            const filters = {
                lat: locationId ? null : lat,
                lon: locationId ? null : lon,
                currentTime: new Date().toISOString(),
                locationId,
                radius: parseInt(radius),
                sort,
                openNow,
                restaurantName,
                cuisines: Array.from(selectedCuisines.has("Select All") ? [] : selectedCuisines),
                priceRange: Array.from(selectedPrices),
                minRating: selectedRating,
                pageNumber: selectedPage,
                pageSize: 21
            };

            fetchRestaurants(filters, isShowMore);
        }

        const handleClickImpression = async (id, event, impressionOptions) => {
            try {
                const response = await fetch('{api}/Restaurant/impression/{bankCustomerOfferGroupId}', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json; charset=UTF-8',
                        'Authorization': 'Basic ZTUzNGUwM2UtYWQ2NS00MjRhLWI5ZmYtMzc0NmM0NWMxODhhLTM1MDE2OTQ4LTlmZTctNDUzYy05OWQxLTk4NjZmZmIzNDEyYy00MDQ2ODhmNC03NGI2LTRlOTAtYTFhYS1hYmM1NTBjZTRhYTE='
                    },
                    body: JSON.stringify({
                        retailerId: id,
                        event: event || ["click", "view"],
                        ...impressionOptions
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const text = await response.text();
                if (!text) {
                    console.warn("Empty response body");
                    return {};
                }

                return JSON.parse(text);
            } catch (error) {
                console.error("Error in handleClickImpression:", error);
            }
        };

        const fetchRestaurants = async (filters, isShowMore) => {
            //const api = 'http://localhost:60839/api';
            const id = ' Sn8FMPcMnUG39jdxk0ezyw'

            // fetch(`{api}Restaurant/search/{bankCustomerOfferGroupId}`, {
            await fetch(`https://api-staging.revenewllc.com/api/Restaurant/search/Iy8RO_OJdEWDIAnKF67Jcw`, {
                method: "POST",
                body: JSON.stringify({ ...filters }),
                credentials: 'include',
                headers: {
                    "Content-type": "application/json; charset=UTF-8",
                    "Authorization": "Basic ZTUzNGUwM2UtYWQ2NS00MjRhLWI5ZmYtMzc0NmM0NWMxODhhLTM1MDE2OTQ4LTlmZTctNDUzYy05OWQxLTk4NjZmZmIzNDEyYy00MDQ2ODhmNC03NGI2LTRlOTAtYTFhYS1hYmM1NTBjZTRhYTE="
                    // "Authorization": "Basic {apiKey}"
                }
            })
                .then(response => {
                    showLoading(false);
                    showRestaurantListCard([])
                    showToast("Sorry, we didn't find any matches. Please consider broadening your filters or expanding your radius!");

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    return response.text().then(text => {
                        if (!text) {
                            console.warn("Empty response body");
                            return {};
                        }
                        return JSON.parse(text);
                    });
                })
                .then(data => {
                    console.log("Filtered Data:", data);

                    showCuisineList(data.cuisine);

                    if (data.restaurants.length > 0) {
                        const combined = [...restaurants, ...data.restaurants];

                        const seen = new Set();
                        restaurants = combined.filter(r => {
                            const key = `${r.name}-${r.address}`;
                            if (seen.has(key)) return false;
                            seen.add(key);
                            return true;
                        });

                        if (isShowMore) {
                            showRestaurantListCard(restaurants);
                        } else {
                            showRestaurantListCard(data.restaurants);
                        }

                        restaurantsResult.style.display = "block";
                        showToast(false);
                    } else {
                        showRestaurantListCard([])
                        showToast("Sorry, we didn't find any matches. Please consider broadening your filters or expanding your radius!");
                    }

                    document.getElementById("loadMore").style.display = data.hasNextPage ? "flex" : "none";

                    showLoading(false);
                })
                .catch(error => {
                    console.error("Fetch error:", error);
                    showLoading(false);
                });
        }

        const loadMore = () => {
            selectedPage++;
            applyFilter(true);
        }

        function clearFilter() {
            document.getElementById("cityInput").value = "";
            document.getElementById("radius").value = 15;
            document.getElementById("sort").value = "distance";
            document.getElementById("openNow").checked = false;
            document.getElementById("cityInput").cityId = null;

            document.querySelectorAll(".cuisine-group button, .price-group button").forEach((btn) => {
                btn.classList.remove("selected");
            });

            selectedCuisines.clear();
            selectedPrices.clear();
            setRating(0);
            resetLocation();
        }

        const showCuisineList = (dataArray) => {
            const cuisineList = document.getElementById("cuisineList");
            cuisineList.innerHTML = "";

            dataArray.forEach((item) => {
                const cuisineButton = document.createElement("button");
                cuisineButton.textContent = item;

                if (selectedCuisines.has(item)) {
                    cuisineButton.classList.add("selected");
                }

                cuisineButton.addEventListener("click", () => {
                    selectCuisine(cuisineButton);
                });

                cuisineList.appendChild(cuisineButton);
            });
        };

        function showPosition(position) {
            lat = position.coords.latitude.toFixed(2);
            lon = position.coords.longitude.toFixed(2);

            input.value = "Current Location";
        }

        function resetLocation() {
            input.value = "";
            locationId = null;

            lat = null;
            lon = null;
        }

        function handleError(error) {
            switch (error.code) {
                case error.PERMISSION_DENIED:
                    alert("User denied the request for Geolocation.");
                    break;
                case error.POSITION_UNAVAILABLE:
                    alert("Location information is unavailable.");
                    break;
                case error.TIMEOUT:
                    alert("The request to get user location timed out.");
                    break;
                case error.UNKNOWN_ERROR:
                    alert("An unknown error occurred.");
                    break;
            }
        }

        const renderPrice = (price) => {
            if (price === null) {
                return '$'
            }
            return '$'.repeat(price);
        };

        const showRestaurantListCard = (data) => {
            if (!data || data.length === 0) {
                restaurantsResult.style.display = "none";
            }

            container.innerHTML = "";

            data.forEach((restaurant, index) => {
                const card = document.createElement("div");
                card.classList = "results__list__item";

                card.addEventListener("click", () => handleClickImpression(restaurant.retailerId));

                card.innerHTML = `
                    <div class="results__list__item__header">
                        <div></div>
                        <strong>${restaurant.offerIncentiveCaption}</strong>
                        <div>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="-0.625 -0.625 20 20"><path fill="none" stroke="#000" stroke-miterlimit="10" stroke-width="1.25" d="M1.172 9.375a8.203 8.203 0 1 0 16.406 0 8.203 8.203 0 1 0-16.406 0M4.898 9.375h8.954M9.375 4.898v8.954"/></svg>    
                        </div>
                    </div>
                    <img src="${restaurant.retailerLogoUrl}"
                        alt="" height="100">
                    <strong>${restaurant.retailer}</strong>
                    <div class="results__rating">
                        <div class="stars">
                            ${filledStarSml}
                        </div>
                        <p>${restaurant.ratingAverage.toFixed(1)} (${restaurant.ratingCount})</p>
                        <p>${renderPrice(restaurant.priceRange)}</p>
                    </div>
                    

                    <div style="display: flex; align-items: center; flex-wrap: wrap; gap: 6px; justify-content: center">
                         ${restaurant.cuisines && restaurant.cuisines.length > 0 ? `
                            <div style="display: flex; flex-wrap: wrap;">
                                <div style="margin-left: 6px">${restaurant.cuisines[0]} Cuisine</div>
                            </div>
                        ` : ''}
                        <div style="display: flex; align-items: center; text-align: center; gap: 6px">
                            <svg fill="#000000" height="14px" width="14px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
                                viewBox="0 0 51.636 51.636" xml:space="preserve">
                                <path d="M51.353,0.914c-0.295-0.305-0.75-0.39-1.135-0.213L0.583,23.481c-0.399,0.184-0.632,0.605-0.574,1.041
                                s0.393,0.782,0.826,0.854l22.263,3.731l2.545,21.038c0.054,0.438,0.389,0.791,0.824,0.865c0.057,0.01,0.113,0.015,0.169,0.015
                                c0.375,0,0.726-0.211,0.896-0.556l24-48.415C51.72,1.675,51.648,1.218,51.353,0.914z"/>
                            </svg>
                            <span>${restaurant.distance}</span>
                        </div>
                    </div>
                    <a href="${restaurant.retailerUrl}" target="_blank" class="btn--primary" style="padding: 12px 40px; font-size: 14px">
                        ${restaurant.buttonCaption}
                    </a>

                     <div class="arrow-bottom"
                        style="position: absolute; bottom: -12px; width:22px; height: 22px; border-left: 2px solid #e74c3c; border-bottom: 2px solid #e74c3c; transform: rotate(-45deg); border-top-right-radius: 50px; background: #fff">
                    </div>
                `;

                card.addEventListener("click", () => {
                    showDetailCard(data, index);
                });

                container.appendChild(card);

                if ((index + 1) % 3 === 0) {
                    const detailRow = document.createElement("div");
                    detailRow.className = "detail-row";
                    container.appendChild(detailRow);
                }
            });
        }

        function showToast(message) {
            const container = document.getElementById("toast-container");

            container.innerHTML = "";

            if (!message) {
                return container.style.display = "none";
            }

            container.style.display = "block";

            const toast = document.createElement("div");
            toast.textContent = message;
            toast.style.cssText = `
                text-align: center;
                background-color: #333;
                color: #fff;
                padding: 12px 20px;
                margin-top: 10px;
                border-radius: 5px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                font-family: sans-serif;
                font-size: 14px;
                animation: fadeIn 0.3s ease;
            `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.style.transition = "opacity 0.5s ease";
                toast.style.opacity = "0";
                setTimeout(() => toast.remove(), 500);
            }, 10000);
        }

        const showImageSlider = (images, id) => {
            const imgArr = typeof images === 'string' ? JSON.parse(images) : images;
            const container = document.getElementById("carousel-container");

            if (!container) {
                console.error("No element with ID 'carousel-container' found.");
                return;
            }

            const sliderWrapper = document.createElement("div");
            sliderWrapper.className = "slider-wrapper";

            const leftArrow = document.createElement("div");
            leftArrow.className = "arrow left";
            leftArrow.innerHTML = "&lt;";

            const rightArrow = document.createElement("div");
            rightArrow.className = "arrow right";
            rightArrow.innerHTML = "&gt;";

            const slider = document.createElement("div");
            slider.className = "slider";

            imgArr.forEach((image, index) => {
                const slide = document.createElement("div");

                slide.className = "slide";
                slide.style.backgroundImage = `url(${image})`;

                if (index === 0) slide.classList.add("active");

                slider.appendChild(slide);
            });

            let currentIndex = 0;
            const slides = () => slider.querySelectorAll(".slide");

            const updateArrows = () => {
                leftArrow.classList.toggle("disabled", currentIndex === 0);
                rightArrow.classList.toggle("disabled", currentIndex === imgArr.length - 1);
            };

            const updateSlide = (newIndex) => {
                if (newIndex < 0 || newIndex >= imgArr.length) return;

                slides()[currentIndex].classList.remove("active");

                currentIndex = newIndex;

                slides()[currentIndex].classList.add("active");

                updateArrows();
            };

            leftArrow.addEventListener("click", () => updateSlide(currentIndex - 1));
            rightArrow.addEventListener("click", () => updateSlide(currentIndex + 1));

            leftArrow.addEventListener("click", () => handleClickImpression(id, ['click']));
            rightArrow.addEventListener("click", () => handleClickImpression(id, ['click']));

            updateArrows();

            sliderWrapper.appendChild(leftArrow);
            sliderWrapper.appendChild(slider);
            sliderWrapper.appendChild(rightArrow);
            container.appendChild(sliderWrapper);
        };

        function showDetailCard(data, index) {
            const rowIndex = Math.floor(index / 3);
            let detailRow = document.querySelectorAll(".detail-row")[rowIndex];

            const cardElements = document.querySelectorAll(".results__list__item");

            cardElements.forEach(card => card.classList.remove("card-opened"));

            // If the same card is clicked again, close it
            if (openIndex === index) {
                detailRow.innerHTML = "";
                detailRow.classList.remove("is-open");
                openIndex = null;
                return;
            }

            if (!detailRow) {
                const newDetailRow = document.createElement("div");
                newDetailRow.className = "detail-row";

                const lastCard = cardElements[cardElements.length - 1];
                lastCard.parentNode.insertBefore(newDetailRow, lastCard.nextSibling);

                detailRow = newDetailRow;
            }

            // Close any open detail card
            document.querySelectorAll(".detail-row").forEach(el => el.innerHTML = "");
            detailRow.classList.add("is-open");

            const detailCard = document.createElement("div");
            detailCard.className = "detail-card";

            const {
                retailerUrl,
                buttonCaption,
                menuUrl,
                bookingProviderUrl,
                retailer,
                ratingAverage,
                address,
                city,
                phoneNumber,
                offerIncentiv,
                offerDetails,
                retailerId,
                priceRange,
                cuisines,
                offerTermsAndConditions,
                locationUrl,
                offerIncentiveCaption
            } = data[index];


            const renderButton = (url, label, retailerId) =>
                url ? `<a href="${url}" class="btn--primary" data-retailer-id="${retailerId}" style="padding: 12px 40px; font-size: 14px">${label}</a>` : '';

            // document.addEventListener('click', function (event) {
            //     const button = event.target.closest('.btn--primary');
            //     if (button && button.dataset.retailerId) {
            //         handleClickImpression(button.dataset.retailerId);
            //     }
            // });

            const buttonsHTML = `
                <div style="display: flex; justify-content: center; width: 100%; margin-top: 12px; gap: 8px">
                    ${renderButton(retailerUrl, buttonCaption)}
                    ${renderButton(menuUrl, 'View Menu')}
                    ${renderButton(bookingProviderUrl, 'Booking')}
                </div>
            `;

            detailCard.innerHTML = `
                <div class="detail-card__media">                    
                    <div id="carousel-container"></div>

                    <h3>${retailer}</h3>
                    <div class="results__rating">
                        <div class="stars">
                            ${renderStars(ratingAverage)}
                        </div>
                        <p>${ratingAverage.toFixed(1)} (1023)</p>
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <a href="${locationUrl}" target="_blank" id="location-url">
                            <img src="https://revenew-public-staging.s3.us-east-2.amazonaws.com/Images/MapsArrow.png" height="60px" id="location-url-img" />
                        </a>

                        <div style="text-align: center">
                            <p style="color: #555; margin-bottom: 8px;">${address}</p>
                            <p style="color: #555; margin-bottom: 8px;">${city}</p>
                            <p style="color: #555; font-size: 20px; font-weight: 600">${phoneNumber}</p>
                        </div>

                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 6px; padding: 8px; border: 1px solid #555; width: 100%;">
                        ${showWorkingHours(data[index]?.workingHours)}
                    </div>
                </div>
                
                <div class="detail-card__info">
                    <div style="display: flex; flex-direction: column; align-items: flex-start; gap: 12px; width: 100%;">
                        <div style="width: 100%;">
                            <p style="font-size: 22px; text-align: center;"><strong>${offerIncentiveCaption}</strong></p>
                        </div>
                        
                        ${offerDetails}

                        <div style="display: flex; align-items: center; gap: 12px;">
                            <p style="font-weight: bold;">Price Range:</p>
                            <p>
                                ${priceRange}
                            </p>
                        </div>
                        ${cuisines && cuisines.length > 0 ? `
                            <div style="display: flex; flex-wrap: wrap, align-items: center; gap: 12px">
                                <p style="font-weight: bold;">Cuisines:</p>
                                <div style="display: flex; flex-wrap: wrap;">
                                    ${cuisines.map(item => `<div style="margin-left: 6px">${item}</div>`).join(', ')}
                                </div>
                            </div>
                        ` : ''}

                        ${buttonsHTML}
                    </div>

                    <div style="margin-top: 24px;">
                        ${offerTermsAndConditions}
                    </div>
                </div>
            `;

            detailRow.appendChild(detailCard);
            openIndex = index;

            cardElements[index].classList.add("card-opened");

            showImageSlider(data[index].images, retailerId);
        }

        const showWorkingHours = (hours) => {
            const parsedHours = typeof hours === 'string' ? JSON.parse(hours) : hours;

            const fullDayMap = {
                Mon: 'Monday',
                Tue: 'Tuesday',
                Wed: 'Wednesday',
                Thu: 'Thursday',
                Fri: 'Friday',
                Sat: 'Saturday',
                Sun: 'Sunday'
            };

            const html = parsedHours.map(entry => {
                const dayName = fullDayMap[entry.dayOfWeek] || entry.dayOfWeek;
                if (!entry.openForBusiness || !entry.dayHours.length) {
                    return `
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; font-size: 14px">
                            <p>${dayName}</p>
                            <p style="text-align: right">Closed</p>
                        </div>
                    `;
                }

                const hoursStr = entry.dayHours
                    .map(period => `${period.open}  ${period.close}`)
                    .join('<br />');

                return `
                    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 12px; font-size: 14px">
                        <p>${dayName}</p>
                        <p style="text-align: right">${hoursStr}</p>
                    </div>
                `;
            }).join('');

            return html;
        }

        // GET LOCATION 
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
        } else {
            alert("Geolocation is not supported by this browser.");
        }

        // Initial render
        updateStars(selectedRating);
        setRating(selectedRating);
        applyFilter();
    </script>
</body>

</html>
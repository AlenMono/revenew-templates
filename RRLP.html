<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=1080, initial-scale=1.0">
    <title>Filter UI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            width: 1080px;
            margin: 0 auto;
        }

        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }

        .card--primary {
            display: flex;
            flex-direction: column;
            
            max-width: 1080px;
            margin: 0 auto;

            padding: 16px;

            background-color: #eee;
        }

        .btn--apply {
            padding: 10px 20px;
            display: flex;
            gap: 8px;
            align-items: center;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn--apply svg {
            transition: all 0.3s ease;
            fill: #000;
        }

        .btn--apply:hover {
            background-color: #000000;
            color: white;
        }

        .btn--apply:hover svg {
            fill: white;
        }

        .btn--clear {
            margin-left: 12px;
            padding: 12px 20px;
            border: none;
            cursor: pointer;

            color: #555;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .btn--clear:hover {
            background-color: #000000;
            color: white;
        }

        .filter__footer {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
        }

        .selected {
            border-color: red !important;
            background-color: #ffe;
        }

        .zip-code-input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .filter-section {
            max-width: 1080px;
            margin: 12px auto;
            background: #eee;
            padding: 20px;
        }

        .filter-group {
            margin-bottom: 15px;
        }

        .filter-group label {
            font-weight: bold;
            margin-right: 10px;
        }

        .button-group button,
        .price-group button,
        .cuisine-group button {
            padding: 8px 12px;
            margin: 4px;
            border: 2px solid #000;
            background: #fff;
            cursor: pointer;
            border-radius: 10px;
        }

        .selected {
            border-color: orange;
            background-color: #ffe;
        }

        .stars { 
            display: flex;
            gap: 4px;

            font-size: 24px;
            cursor: pointer;
        }

        .star-icon {
            cursor: pointer;
            transition: fill 0.2s;
        }

        .star-icon.selected {
            fill: gold;
            stroke: #000
        }

        .card-opened {
            position: relative;
            border: 2px solid #008555 !important;
            z-index: 1;
        }

        .arrow-bottom {
            display: none;
        }

        .card-opened .arrow-bottom {
            display: block;
        }

        #suggestions {
            display: none;
            list-style: none;
            padding-left: 0;
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 4px;
            z-index: 10;
        }

        #suggestions li:hover {
            background-color: #f0f0f0;
        }

        .results__list {
            display: grid;
            /* SET AS VARIABLE */
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .results__list__item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;

            padding: 12px;

            text-align: center;

            border: 1px solid #1f1f1f;
            background-color: #fff;

            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        .results__list__item:hover {
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        }

        .results__list__item__header {
            width: 100%;

            display: flex;
            align-items: center;
            justify-content: space-between;
            
            gap: 8px;

            margin-bottom: 6px;
        }

        .results__rating {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .btn--primary {
            padding: 12px 24px;

            color: #fff;
            font-weight: bold;
            background-color: #e74c3c;
            border: 1px solid #e74c3c;

            text-decoration: none;
            cursor: pointer;

            transition: all 0.2s ease-in-out;
        }

        .btn--primary:hover {
            background-color: #c0392b;
            border: 1px solid #c0392b;
        }

        .detail-row {
            display: none;
            grid-column: 1 / -1;
        }

        .detail-row.is-open {
            display: block;
        }

        .detail-card {
            display: grid;
            /* SET AS VARIABLE */
            grid-template-columns: 1fr 2fr;
            gap: 20px;

            width: 100%;
            padding: 20px;

            background: #fff;
        }

        .detail-card__media,
        .detail-card__info {
            display: flex;
            flex-direction: column;
            align-items: center;

            gap: 8px;
        }

        .detail-card__info {
            align-items: flex-start;
        }

        .hidden {
            display: none;
        }

        .slider-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            width: 300px;
            height: 200px;
            overflow: hidden;
        }

        .slider {
            display: flex;
            width: 100%;
            height: 100%;
            position: relative;
        }

        .slide {
            min-width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            display: none;
            transition: opacity 0.5s ease-in-out;
        }

        .slide.active {
            display: block;
        }

        .arrow {
            cursor: pointer;
            font-size: 24px;
            font-weight: bold;
            color: black;
            background: white;
            border-radius: 50%;
            padding: 5px 10px;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 2;
            user-select: none;
        }

        .arrow.left {
            left: 5px;
        }

        .arrow.right {
            right: 5px;
        }

        .arrow.disabled {
            opacity: 0.3;
            pointer-events: none;
        }
    </style>
</head>

<body>
    <div class="filter-section">
        <div style="display: flex; gap: 12px; align-items: center; justify-content: space-between; flex-wrap: wrap; margin-bottom: 16px;">
            <div style="position: relative;">
                <div style="display: flex; gap: 8px; align-items: center;">
                    <div style="display: flex; align-items: center;">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="#000000" id="Location--Streamline-Tabler-Filled" height="20" width="20">
                            <desc>
                                Location Streamline Icon: https://streamlinehq.com
                            </desc>
                            <path d="M17.409166666666668 1.6716666666666666 17.497500000000002 1.6666666666666667l0.10833333333333334 0.006666666666666667 0.075 0.013333333333333334 0.10250000000000001 0.02916666666666667 0.08916666666666667 0.03833333333333334 0.08333333333333334 0.0475 0.075 0.05583333333333334 0.06833333333333334 0.0625 0.043333333333333335 0.049166666666666664 0.06833333333333334 0.09666666666666668 0.043333333333333335 0.08c0.03916666666666667 0.08333333333333334 0.06416666666666666 0.17166666666666666 0.075 0.26333333333333336l0.004166666666666667 0.08833333333333333c0 0.0625 -0.006666666666666667 0.12416666666666666 -0.02 0.18333333333333335l-0.02916666666666667 0.10250000000000001 -5.443333333333333 15.064166666666669A1.2916666666666667 1.2916666666666667 0 0 1 11.666666666666668 18.6a1.2891666666666666 1.2891666666666666 0 0 1 -1.1075 -0.6225l-0.05416666666666667 -0.10583333333333333 -2.7933333333333334 -5.585 -5.558333333333334 -2.78a1.2916666666666667 1.2916666666666667 0 0 1 -0.7483333333333334 -1.0491666666666666L1.4 8.333333333333334c0 -0.46666666666666673 0.25083333333333335 -0.8933333333333334 0.7008333333333333 -1.1416666666666668l0.11666666666666668 -0.05833333333333334 15.014166666666666 -5.421666666666667 0.08833333333333333 -0.025 0.09 -0.015z" stroke-width="0.8333"></path>
                        </svg>
                    </div>
                    <input type="text" id="cityInput" class="zip-code-input" placeholder="Enter City or Zip Code"
                    autocomplete="off" />

                </div>
                <ul id="suggestions"></ul>
            </div>

            <div>
                <label for="radius">Radius</label>
                <input type="number" id="radius" value="15"
                    style="width: 76px; padding: 6px 8px; border-radius: 6px;" /> miles
            </div>

            <div>
                <label for="sort">Sort by:</label>
                <select id="sort" style="padding: 6px 8px; border-radius: 6px;">
                    <option value="distance">Closest Distance</option>
                    <option value="priceHighLow">Price High/Low</option>
                    <option value="priceLowHigh">Price Low/High</option>
                    <option value="ratingHighLow">Rating High/Low</option>
                </select>
            </div>

            <div style="display: flex; align-items: center; gap: 8px;">
                <label>
                    <input type="checkbox" id="openNow" /> 
                </label>
                <p style="font-size: 14x; font-weight: bold;">
                    Open Now
                </p>
            </div>
        </div>
        
        <div class="filter-group cuisine-group" style="display: flex; align-items: flex-start; gap: 30px">
            <div style="display: flex; align-items: center; gap: 8px;">
                <label>Cuisine</label>
                <button onclick="selectCuisine(this)" style="padding-left: 30px; padding-right: 30px; white-space: nowrap;">Select All</button>
            </div>
            
            <div id="cuisineList"></div>
        </div>

        <div style="display: flex; gap: 12px;">
            <div class="filter-group price-group">
                <label>Price</label>
                <button onclick="selectPrice(this)">$</button>
                <button onclick="selectPrice(this)">$$</button>
                <button onclick="selectPrice(this)">$$$</button>
                <button onclick="selectPrice(this)">$$$$</button>
            </div>

            <div class="filter-group" style="display: flex; align-items: center; gap: 8px">
                <label>Minimum Rating</label>
                <div class="stars" id="starRating"></div>
            </div>
        </div>

        <div class="filter__footer">
            <div></div>
            <button onclick="applyFilter()" class="btn--apply">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none">
                    <path fill="" fill-rule="evenodd"
                        d="M11.167 1.333a1 1 0 1 0 0 2 1 1 0 0 0 0-2ZM0 3h8.93a2.334 2.334 0 0 0 4.473 0H16V1.667h-2.597a2.334 2.334 0 0 0-4.473 0H0V3Zm8.93 11.333H0V13h8.93a2.334 2.334 0 0 1 4.473 0H16v1.333h-2.597a2.334 2.334 0 0 1-4.473 0Zm1.237-.666a1 1 0 1 1 2 0 1 1 0 0 1-2 0ZM16 7.333H7.903a2.334 2.334 0 0 0-4.473 0H0v1.334h3.43a2.334 2.334 0 0 0 4.473 0H16V7.333ZM5.667 7a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z"
                        clip-rule="evenodd" />
                </svg>
                Apply Filter
            </button>
            <button onclick="clearFilter()" class="btn--clear">
                Clear Filter
            </button>
        </div>
    </div>

    <div id="toast-container" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;"></div>

    <div class="card--primary" id="restaurantsResult" style="display: none;">
        <!-- Cards will be inserted here by JS -->
        <div class="results__list" id="cardsContainer"></div>

        <div style="display: flex; flex-direction: column; align-items: center; margin-top: 20px;" id="loadMore">
            <button class="btn--primary" onclick="loadMore()">Show More</button>
        </div>
    </div>

    <script>
        const input = document.getElementById("cityInput");
        const suggestions = document.getElementById("suggestions");
        const container = document.getElementById("cardsContainer");
        const starContainer = document.getElementById('starRating');

        const selectedCuisines = new Set();
        const selectedPrices = new Set();
        let restaurants = [];

        let selectedRating = 0;
        let selectedPage = 1;
        let openIndex = null;
        let lat, lon, hasNextPage, debounceTimeout;

        const filledStar = `
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none"><path fill="#ffd709" d="M9.636 16.106a.828.828 0 0 1 .728 0l4.428 2.34a.77.77 0 0 0 1.12-.813l-.854-5.002a.744.744 0 0 1 .224-.672l3.587-3.461a.757.757 0 0 0-.462-1.303l-4.918-.729a.714.714 0 0 1-.575-.42l-2.227-4.498a.757.757 0 0 0-1.374 0L7.086 6.046a.714.714 0 0 1-.575.42l-4.918.729a.756.756 0 0 0-.462 1.303l3.587 3.46a.742.742 0 0 1 .224.673l-.855 5.002a.77.77 0 0 0 1.121.813l4.428-2.34Z"/><path fill="#000" fill-rule="evenodd" d="M8.508 1.164C8.778.59 9.368.217 10 .217c.633 0 1.222.374 1.492.946l2.194 4.43 4.824.715c.63.062 1.18.492 1.393 1.09a1.663 1.663 0 0 1-.414 1.743l-3.538 3.413.841 4.926a1.676 1.676 0 0 1-.662 1.632 1.677 1.677 0 0 1-1.739.132l-.016-.009L10 16.923l-4.375 2.312a1.677 1.677 0 0 1-1.755-.123 1.676 1.676 0 0 1-.662-1.632l.841-4.926L.511 9.141a1.663 1.663 0 0 1-.414-1.743 1.663 1.663 0 0 1 1.393-1.09l4.824-.715 2.194-4.43Zm3.6 5.266c.231.5.712.852 1.258.92l4.687.695-3.38 3.261-.001.001a1.646 1.646 0 0 0-.494 1.475l.813 4.76-4.21-2.225a1.73 1.73 0 0 0-1.54-.012h.001a.841.841 0 0 0-.023.012l-4.21 2.224.813-4.76.001-.005a1.646 1.646 0 0 0-.494-1.468L1.948 8.045l4.687-.694a1.619 1.619 0 0 0 1.256-.92L10 2.174l2.108 4.256Z" clip-rule="evenodd"/></svg>
        `;

        const outlineStar = `
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none"><path fill="" d="M9.636 16.106a.828.828 0 0 1 .728 0l4.428 2.34a.77.77 0 0 0 1.12-.813l-.854-5.002a.744.744 0 0 1 .224-.672l3.587-3.461a.757.757 0 0 0-.462-1.303l-4.918-.729a.714.714 0 0 1-.575-.42l-2.227-4.498a.757.757 0 0 0-1.374 0L7.086 6.046a.714.714 0 0 1-.575.42l-4.918.729a.756.756 0 0 0-.462 1.303l3.587 3.46a.742.742 0 0 1 .224.673l-.855 5.002a.77.77 0 0 0 1.121.813l4.428-2.34Z"/><path fill="#000" fill-rule="evenodd" d="M8.508 1.164C8.778.59 9.368.217 10 .217c.633 0 1.222.374 1.492.946l2.194 4.43 4.824.715c.63.062 1.18.492 1.393 1.09a1.663 1.663 0 0 1-.414 1.743l-3.538 3.413.841 4.926a1.676 1.676 0 0 1-.662 1.632 1.677 1.677 0 0 1-1.739.132l-.016-.009L10 16.923l-4.375 2.312a1.677 1.677 0 0 1-1.755-.123 1.676 1.676 0 0 1-.662-1.632l.841-4.926L.511 9.141a1.663 1.663 0 0 1-.414-1.743 1.663 1.663 0 0 1 1.393-1.09l4.824-.715 2.194-4.43Zm3.6 5.266c.231.5.712.852 1.258.92l4.687.695-3.38 3.261-.001.001a1.646 1.646 0 0 0-.494 1.475l.813 4.76-4.21-2.225a1.73 1.73 0 0 0-1.54-.012h.001a.841.841 0 0 0-.023.012l-4.21 2.224.813-4.76.001-.005a1.646 1.646 0 0 0-.494-1.468L1.948 8.045l4.687-.694a1.619 1.619 0 0 0 1.256-.92L10 2.174l2.108 4.256Z" clip-rule="evenodd"/></svg>
        `;

        const debounce = (func, delay) => {
            return function (...args) {
                clearTimeout(debounceTimeout);
                debounceTimeout = setTimeout(() => func.apply(this, args), delay);
            };
        }

        const fetchCities = async (query) => {
            if (!query) {
                suggestions.innerHTML = "";
                input.cityId = null
                return;
            }

            try {
                // const res = await fetch(`{api}OfferCommunication/City?Name=${encodeURIComponent(query)}`, {
                const res = await fetch(`https://api-staging.revenewllc.com/api/OfferCommunication/City?Name=${encodeURIComponent(query)}`, {
                    method: "GET",
                    credentials: 'include',
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": "Basic ZTUzNGUwM2UtYWQ2NS00MjRhLWI5ZmYtMzc0NmM0NWMxODhhLTM1MDE2OTQ4LTlmZTctNDUzYy05OWQxLTk4NjZmZmIzNDEyYy00MDQ2ODhmNC03NGI2LTRlOTAtYTFhYS1hYmM1NTBjZTRhYTE="
                        // "Authorization": "Basic {apiKey}"
                    }
                });

                const data = await res.json();
                displaySuggestions(data || []);
            } catch (err) {
                console.error("City lookup failed:", err);
            }
        }

        const displaySuggestions = (cities) => {
            suggestions.innerHTML = "";
            suggestions.style.display = cities.length ? "block" : "none";

            cities.forEach((city) => {
                const li = document.createElement("li");
                li.textContent = city.name;

                li.style.cursor = "pointer";
                li.style.padding = "8px 10px";
                li.style.fontSize = "14px";

                li.addEventListener("click", () => {
                    input.cityId = city.id;
                    input.value = city.name;

                    suggestions.innerHTML = "";
                    suggestions.style.display = "none";
                });

                suggestions.appendChild(li);
            });
        }

        input.addEventListener(
            "input",
            debounce((e) => {
                const query = e.target.value.trim();
                fetchCities(query);
            }, 400)
        );

        const selectCuisine = (button) => {
            const allButtons = Array.from(document.querySelectorAll('.cuisine-group button'));
            const cuisineButtons = allButtons.filter(b => b.innerText !== "Select All");

            if (button.innerText === "Select All") {
                const allSelected = cuisineButtons.every(btn => btn.classList.contains('selected'));

                cuisineButtons.forEach(btn => {
                    btn.classList.toggle('selected', !allSelected);
                    if (!allSelected) {
                        selectedCuisines.add(btn.innerText);
                    } else {
                        selectedCuisines.delete(btn.innerText);
                    }
                });

                button.classList.toggle('selected', !allSelected);
                if (!allSelected) {
                    selectedCuisines.add("Select All");
                } else {
                    selectedCuisines.delete("Select All");
                }
            } else {
                button.classList.toggle("selected");

                if (button.classList.contains("selected")) {
                    selectedCuisines.add(button.innerText);
                } else {
                    selectedCuisines.delete(button.innerText);
                }

                const allSelected = cuisineButtons.every(btn => btn.classList.contains('selected'));
                const selectAllBtn = allButtons.find(b => b.innerText === "Select All");

                selectAllBtn.classList.toggle("selected", allSelected);
                if (allSelected) {
                    selectedCuisines.add("Select All");
                } else {
                    selectedCuisines.delete("Select All");
                }
            }
        };

        const selectPrice = (button) => {
            button.classList.toggle("selected");
            const priceLevel = button.innerText.trim().lastIndexOf('$') + 1;

            if (button.classList.contains("selected")) {
                selectedPrices.add(priceLevel);
            } else {
                selectedPrices.delete(priceLevel);
            }
        };

        const renderStars = (rating) => {
            return Array.from({ length: 5 }, (_, i) =>
                `<span class="star-wrapper" data-index="${i + 1}" style="cursor: pointer; display: inline-block;">${i + 1 <= rating ? filledStar : outlineStar}</span>`
            ).join('');
        };

        const updateStars = (rating) => {
            starContainer.innerHTML = renderStars(rating);

            starContainer.querySelectorAll('.star-wrapper').forEach((el) => {
                el.addEventListener('click', () => {
                const index = parseInt(el.dataset.index);
                selectedRating = (selectedRating === index) ? 0 : index;
                updateStars(selectedRating);
                });
            });
        };

        function setRating(rating) {
            selectedRating = selectedRating === rating ? 0 : rating;
            renderStars();
        }

        function applyFilter(isShowMore) {
            const locationId = document.getElementById("cityInput").cityId;
            const radius = document.getElementById("radius").value;
            const sort = document.getElementById("sort").value;
            const openNow = document.getElementById("openNow").checked;

            const filters = {
                lat,
                lon,
                currentTime: new Date().toISOString(),
                locationId,
                radius: parseInt(radius),
                sort,
                openNow,
                cuisines: Array.from(selectedCuisines.has("Select All") ? [] : selectedCuisines),
                priceRange: Array.from(selectedPrices),
                minRating: selectedRating,
                pageNumber: selectedPage,
                pageSize: 21
            };

            //const api = 'http://localhost:60839/api';
            const id = ' Sn8FMPcMnUG39jdxk0ezyw'

            // fetch(`{api}Restaurant/search/{bankCustomerOfferGroupId}`, {
            fetch(`https://api-staging.revenewllc.com/api/Restaurant/search/Iy8RO_OJdEWDIAnKF67Jcw`, {
                method: "POST",
                body: JSON.stringify({ ...filters }),
                credentials: 'include',
                headers: {
                    "Content-type": "application/json; charset=UTF-8",
                    "Authorization": "Basic ZTUzNGUwM2UtYWQ2NS00MjRhLWI5ZmYtMzc0NmM0NWMxODhhLTM1MDE2OTQ4LTlmZTctNDUzYy05OWQxLTk4NjZmZmIzNDEyYy00MDQ2ODhmNC03NGI2LTRlOTAtYTFhYS1hYmM1NTBjZTRhYTE="
                    // "Authorization": "Basic {apiKey}"
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                return response.text().then(text => {
                    if (!text) {
                        console.warn("Empty response body");
                        return {};
                    }
                    return JSON.parse(text);
                });
            })
            .then(data => {
                console.log("Filtered Data:", data);

                showCuisineList(data.cuisine);

                if (data.restaurants.length > 0) {
                    const combined = [...restaurants, ...data.restaurants];

                    const seen = new Set();
                    restaurants = combined.filter(r => {
                        const key = `${r.name}-${r.address}`;
                        if (seen.has(key)) return false;
                        seen.add(key);
                        return true;
                    });

                    if(isShowMore) {
                    showRestaurantListCard(restaurants);
                    } else {
                        showRestaurantListCard(data.restaurants);
                    }

                    restaurantsResult.style.display = "block";
                } else {
                    showToast("No results found!");
                }

                document.getElementById("loadMore").style.display = data.hasNextPage ? "flex" : "none";
            })
            .catch(error => {
                console.error("Fetch error:", error);
            });
        }

        const loadMore = () => {
            selectedPage++;
            applyFilter(true);
        }

        function clearFilter() {
            document.getElementById("cityInput").value = "";
            document.getElementById("radius").value = 15;
            document.getElementById("sort").value = "distance";
            document.getElementById("openNow").checked = false;

            document.querySelectorAll(".cuisine-group button, .price-group button").forEach((btn) => {
                btn.classList.remove("selected");
            });

            selectedCuisines.clear();
            selectedPrices.clear();
            setRating(0);
            resetLocation();
        }

        const showCuisineList = (dataArray) => {
            const cuisineList = document.getElementById("cuisineList");
            cuisineList.innerHTML = "";

            dataArray.forEach((item) => {
                const cuisineButton = document.createElement("button");
                cuisineButton.textContent = item;

                if (selectedCuisines.has(item)) {
                    cuisineButton.classList.add("selected");
                }

                cuisineButton.addEventListener("click", () => {
                    selectCuisine(cuisineButton);
                });

                cuisineList.appendChild(cuisineButton);
            });
        };

        function showPosition(position) {
            lat = position.coords.latitude.toFixed(2);
            lon = position.coords.longitude.toFixed(2);

            input.value = "Current Location";
        }

        function resetLocation() {
            input.value = "";
            locationId = null;

            lat = null;
            lon = null;
        }

        function handleError(error) {
            switch (error.code) {
                case error.PERMISSION_DENIED:
                    alert("User denied the request for Geolocation.");
                    break;
                case error.POSITION_UNAVAILABLE:
                    alert("Location information is unavailable.");
                    break;
                case error.TIMEOUT:
                    alert("The request to get user location timed out.");
                    break;
                case error.UNKNOWN_ERROR:
                    alert("An unknown error occurred.");
                    break;
            }
        }

        const renderPrice = (price) => {
            if (price === null) {
                return '$'
            }
            return '$'.repeat(price);
        };

        const showRestaurantListCard = (data) => {
            container.innerHTML = "";

            data.forEach((restaurant, index) => {
                const card = document.createElement("div");
                card.classList = "results__list__item";

                card.innerHTML = `
                    <div class="results__list__item__header">
                        <div></div>
                        <strong>${restaurant.offerIncentiveCaption}</strong>
                        <div>
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="-0.625 -0.625 20 20"><path fill="none" stroke="#000" stroke-miterlimit="10" stroke-width="1.25" d="M1.172 9.375a8.203 8.203 0 1 0 16.406 0 8.203 8.203 0 1 0-16.406 0M4.898 9.375h8.954M9.375 4.898v8.954"/></svg>    
                        </div>
                    </div>
                    <img src="${restaurant.retailerLogoUrl}"
                        alt="" height="100">
                    <strong>${restaurant.retailer}</strong>
                    <div class="results__rating">
                        <div class="stars">
                            <span class="selected" style="line-height: 1;">★</span>
                        </div>
                        <p>${restaurant.ratingAverage} (${restaurant.ratingCount})</p>
                        <p>${renderPrice(restaurant.priceRange)}</p>
                    </div>
                    

                    <div style="display: flex; align-items: center; gap: 6px">
                        <div>${restaurant.cuisine}</div>
                        <svg fill="#000000" height="14px" width="14px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
                            viewBox="0 0 51.636 51.636" xml:space="preserve">
                            <path d="M51.353,0.914c-0.295-0.305-0.75-0.39-1.135-0.213L0.583,23.481c-0.399,0.184-0.632,0.605-0.574,1.041
                            s0.393,0.782,0.826,0.854l22.263,3.731l2.545,21.038c0.054,0.438,0.389,0.791,0.824,0.865c0.057,0.01,0.113,0.015,0.169,0.015
                            c0.375,0,0.726-0.211,0.896-0.556l24-48.415C51.72,1.675,51.648,1.218,51.353,0.914z"/>
                        </svg>
                        <span>${restaurant.distance}</span>
                    </div>
                    <a href="${restaurant.retailerUrl}" class="btn--primary" style="padding: 12px 40px; font-size: 14px">
                        ${restaurant.buttonCaption}
                    </a>

                     <div class="arrow-bottom"
                        style="position: absolute; bottom: -12px; width:22px; height: 22px; border-left: 2px solid #008555; border-bottom: 2px solid #008555; transform: rotate(-45deg); border-top-right-radius: 50px; background: #fff">
                    </div>
                `;

                card.addEventListener("click", () => {
                    showDetailCard(data, index);
                });

                container.appendChild(card);

                if ((index + 1) % 3 === 0) {
                    const detailRow = document.createElement("div");
                    detailRow.className = "detail-row";
                    container.appendChild(detailRow);
                }
            });
        }

        function showToast(message) {
            const container = document.getElementById("toast-container");

            const toast = document.createElement("div");
            toast.textContent = message;
            toast.style.cssText = `
                background-color: #333;
                color: #fff;
                padding: 12px 20px;
                margin-top: 10px;
                border-radius: 5px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                font-family: sans-serif;
                font-size: 14px;
                animation: fadeIn 0.3s ease;
            `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.style.transition = "opacity 0.5s ease";
                toast.style.opacity = "0";
                setTimeout(() => toast.remove(), 500);
            }, 10000);
        }

        const showImageSlider = (images) => {
            const imgArr = typeof images === 'string' ? JSON.parse(images) : images;
            const container = document.getElementById("carousel-container");

            if (!container) {
                console.error("No element with ID 'carousel-container' found.");
                return;
            }

            const sliderWrapper = document.createElement("div");
            sliderWrapper.className = "slider-wrapper";

            const leftArrow = document.createElement("div");
            leftArrow.className = "arrow left";
            leftArrow.innerHTML = "&lt;";

            const rightArrow = document.createElement("div");
            rightArrow.className = "arrow right";
            rightArrow.innerHTML = "&gt;";

            const slider = document.createElement("div");
            slider.className = "slider";

            imgArr.forEach((image, index) => {
                const slide = document.createElement("div");

                slide.className = "slide";
                slide.style.backgroundImage = `url(${image})`;

                if (index === 0) slide.classList.add("active");

                slider.appendChild(slide);
            });

            let currentIndex = 0;
            const slides = () => slider.querySelectorAll(".slide");

            const updateArrows = () => {
                leftArrow.classList.toggle("disabled", currentIndex === 0);
                rightArrow.classList.toggle("disabled", currentIndex === imgArr.length - 1);
            };

            const updateSlide = (newIndex) => {
                if (newIndex < 0 || newIndex >= imgArr.length) return;

                slides()[currentIndex].classList.remove("active");

                currentIndex = newIndex;

                slides()[currentIndex].classList.add("active");

                updateArrows();
            };

            leftArrow.addEventListener("click", () => updateSlide(currentIndex - 1));
            rightArrow.addEventListener("click", () => updateSlide(currentIndex + 1));

            updateArrows();

            sliderWrapper.appendChild(leftArrow);
            sliderWrapper.appendChild(slider);
            sliderWrapper.appendChild(rightArrow);
            container.appendChild(sliderWrapper);
        };

        function showDetailCard(data, index) {
            const rowIndex = Math.floor(index / 3);
            let detailRow = document.querySelectorAll(".detail-row")[rowIndex];

            const cardElements = document.querySelectorAll(".results__list__item");

            cardElements.forEach(card => card.classList.remove("card-opened"));

            // If the same card is clicked again, close it
            if (openIndex === index) {
                detailRow.innerHTML = "";
                detailRow.classList.remove("is-open");
                openIndex = null;
                return;
            }

            if (!detailRow) {
                const newDetailRow = document.createElement("div");
                newDetailRow.className = "detail-row";

                const lastCard = cardElements[cardElements.length - 1];
                lastCard.parentNode.insertBefore(newDetailRow, lastCard.nextSibling);
                
                detailRow = newDetailRow;
            }

            // Close any open detail card
            document.querySelectorAll(".detail-row").forEach(el => el.innerHTML = "");
            detailRow.classList.add("is-open");

            const detailCard = document.createElement("div");
            detailCard.className = "detail-card";

            detailCard.innerHTML = `
                <div class="detail-card__media">                    
                    <div id="carousel-container"></div>

                    <h3>${data[index].retailer}</h3>
                    <div class="results__rating">
                        <div class="stars">
                            ${renderStars(data[index].ratingAverage)}
                        </div>
                        <p>${data[index].ratingAverage} (1023)</p>
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="-0.5 -0.5 12 12" id="Navigation-Next-Hexagon-2--Streamline-Cyber" height="50" width="50">
                            <desc>
                                Navigation Next Hexagon 2 Streamline Icon: https://streamlinehq.com
                            </desc>
                            <path stroke="#555" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M3.895833333333333 4.354166666666666h2.2916666666666665V3.208333333333333l2.2916666666666665 2.0625 -2.2916666666666665 2.0625v-1.1458333333333333H4.583333333333333l-2.0625 1.375 1.375 -3.208333333333333Z" stroke-width="1"></path>
                            <path stroke="#555" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="m9.854166666666666 8.25 -4.583333333333333 2.520833333333333 -4.583333333333333 -2.520833333333333V3.208333333333333l4.583333333333333 -2.520833333333333 4.583333333333333 2.520833333333333v5.041666666666666Z" stroke-width="1"></path>
                        </svg>
                        <div>
                            <p style="color: #555; margin-bottom: 8px;">${data[index].address}</p>
                            <p style="color: #555; margin-bottom: 8px;">${data[index].city}</p>
                            <p style="color: #555; font-size: 18px; font-weight: 600">${data[index].phoneNumber}</p>
                        </div>

                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 6px; padding: 8px; border: 1px solid #555; width: 100%;">
                        ${showWorkingHours(data[index]?.workingHours)}
                    </div>
                </div>
                
                <div class="detail-card__info">
                    <div style="width: 100%;">
                        <p style="font-size: 18px; text-align: center;"><strong>${data[index].offerIncentiveCaption}</strong></p>
                    </div>
                    
                    ${data[index].offerDetails}

                    <div style="display: flex; align-items: center; gap: 12px;">
                        <p style="font-weight: bold;">Price Range:</p>
                        <p>
                            ${renderPrice(data[index].priceRange)}
                        </p>
                    </div>

                    <div style="display: flex; justify-content: center; width: 100%; margin-top: 12px;">
                        <a href="${data[index].retailerUrl}" class="btn--primary" style="padding: 12px 40px; font-size: 14px">
                            ${data[index].buttonCaption}
                        </a>                    
                    </div>

                    <div style="display: flex; flex-direction: column; align-items: center; gap: 12px; margin-top: 24px;">
                        ${data[index].offerTermsAndConditions}
                    </div>
                </div>
            `;


            detailRow.appendChild(detailCard);
            openIndex = index;

            cardElements[index].classList.add("card-opened");

            showImageSlider(data[index].images);
        }

        const showWorkingHours = (hours) => {
            const parsedHours = typeof hours === 'string' ? JSON.parse(hours) : hours;

            const fullDayMap = {
                Mon: 'Monday',
                Tue: 'Tuesday',
                Wed: 'Wednesday',
                Thu: 'Thursday',
                Fri: 'Friday',
                Sat: 'Saturday',
                Sun: 'Sunday'
            };

            const html = parsedHours.map(entry => {
                const dayName = fullDayMap[entry.dayOfWeek] || entry.dayOfWeek;
                if (!entry.openForBusiness || !entry.dayHours.length) {
                    return `
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px">
                            <p>${dayName}</p>
                            <p>Closed</p>
                        </div>
                    `;
                }

                const hoursStr = entry.dayHours
                    .map(period => `${period.open} – ${period.close}`)
                    .join(', ');

                return `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px">
                        <p>${dayName}</p>
                        <p>${hoursStr}</p>
                    </div>
                `;
            }).join('');

            return html;
        }

        // GET LOCATION 
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition, handleError);
        } else {
            alert("Geolocation is not supported by this browser.");
        }

        // Initial render
        updateStars(selectedRating);
        setRating(selectedRating);
        applyFilter();
    </script>
</body>

</html>